<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.agency.mapper.AgencyBankCardMapper">
    <select id="findBankCardById" resultType="org.jeecg.modules.agency.dto.AgencyBankCardDTO">
        SELECT
          CONCAT(
            abc.`bank_name`,
            '(',
            RIGHT(bank_card,4),
            ',',
            abc.`cardholder`,
            ')'
          ) AS sbcName,
          abc.`bank_card`,
          abc.id AS agencyBankCardId,
          abc.car_type
        FROM
          agency_bank_card abc
        WHERE abc.`del_flag` = 0
          AND abc.`sys_user_id` = #{sysUserId}
    </select>
    <select id="queryPageList" resultType="org.jeecg.modules.agency.vo.AgencyBankCardVO">
        SELECT
          su.`avatar`,
          su.`username`,
          am.`name`,
          abc.*
        FROM
          agency_bank_card abc
          LEFT JOIN agency_manage am
            ON abc.`sys_user_id` = am.`sys_user_id`
          LEFT JOIN sys_user su
            ON su.`id` = am.`sys_user_id`
        WHERE abc.`del_flag` = 0
          AND am.`del_flag` = 0
          AND su.`del_flag` = 0
          AND abc.car_type = 0
          <if test="agencyBankCardDTO.username != null and agencyBankCardDTO.username != ''">
              AND su.username LIKE concat('%',#{agencyBankCardDTO.username},'%')
          </if>
        <if test="agencyBankCardDTO.name != null and agencyBankCardDTO.name != ''">
            AND am.name LIKE concat('%',#{agencyBankCardDTO.name},'%')
        </if>
        <if test="agencyBankCardDTO.phone != null and agencyBankCardDTO.phone != ''">
            AND abc.phone LIKE concat('%',#{agencyBankCardDTO.phone},'%')
        </if>
        <if test="agencyBankCardDTO.bankName != null and agencyBankCardDTO.bankName != ''">
            AND abc.bank_name LIKE concat('%',#{agencyBankCardDTO.bankName},'%')
        </if>
        <if test="agencyBankCardDTO.bankCard != null and agencyBankCardDTO.bankCard != ''">
            AND abc.bank_card LIKE concat('%',#{agencyBankCardDTO.bankCard},'%')
        </if>
        <if test="agencyBankCardDTO.createTime_begin != null and agencyBankCardDTO.createTime_begin != ''">
            and abc.create_time <![CDATA[>=]]> CONCAT(#{agencyBankCardDTO.createTime_begin},' 00:00:00')
        </if>
        <if test="agencyBankCardDTO != null and agencyBankCardDTO.createTime_end != null and agencyBankCardDTO.createTime_end != ''">
            AND abc.create_time <![CDATA[<=]]> CONCAT( #{agencyBankCardDTO.createTime_end},' 23:59:59')
        </if>
        <if test="agencyBankCardDTO.updateTime_begin != null and agencyBankCardDTO.updateTime_begin != ''">
            and abc.update_time <![CDATA[>=]]> CONCAT(#{agencyBankCardDTO.updateTime_begin},' 00:00:00')
        </if>
        <if test="agencyBankCardDTO.updateTime_end != null and agencyBankCardDTO.updateTime_end != ''">
            AND abc.update_time <![CDATA[<=]]> CONCAT( #{agencyBankCardDTO.updateTime_end},' 23:59:59')
        </if>
        ORDER BY abc.`create_time` DESC
    </select>
</mapper>
