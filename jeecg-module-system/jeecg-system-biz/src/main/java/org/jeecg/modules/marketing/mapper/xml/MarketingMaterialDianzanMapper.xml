<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.marketing.mapper.MarketingMaterialDianzanMapper">
   <select id="getMarketingMaterialDianzanMap" resultType="map">
       SELECT
          mmd.id AS id,
          ml.head_portrait AS headPortrait,
          ml.nick_name AS nickName,
          ml.phone AS phone,
          DATE_FORMAT(mmd.browse_time,'%Y-%m-%d %H:%i:%s') AS browseTime
        FROM
          `marketing_material_dianzan` mmd
          LEFT JOIN `member_list` ml
            ON ml.id = mmd.member_list_id
        WHERE mmd.del_flag = 0
        <if test="marketingMaterialDianzanVO != null and marketingMaterialDianzanVO.marketingMaterialListId !=null and marketingMaterialDianzanVO.marketingMaterialListId !='' ">
          and  mmd.marketing_material_list_id = #{marketingMaterialDianzanVO.marketingMaterialListId}
        </if>
       <if test="marketingMaterialDianzanVO != null and marketingMaterialDianzanVO.nickName !=null and marketingMaterialDianzanVO.nickName !='' ">
           and  ml.nick_name LIKE CONCAT(CONCAT('%',#{marketingMaterialDianzanVO.nickName}), '%')
       </if>
       <if test="marketingMaterialDianzanVO != null and marketingMaterialDianzanVO.phone !=null and marketingMaterialDianzanVO.phone !='' ">
           and  ml.phone LIKE CONCAT(CONCAT('%',#{marketingMaterialDianzanVO.phone}), '%')
       </if>
       <if test="marketingMaterialDianzanVO != null and marketingMaterialDianzanVO.browseTime_begin != null and marketingMaterialDianzanVO.browseTime_begin != ''">
           and mmd.browse_time <![CDATA[>=]]> concat(#{marketingMaterialDianzanVO.browseTime_begin},' 00:00:00')
       </if>
       <if test="marketingMaterialDianzanVO != null and marketingMaterialDianzanVO.browseTime_end != null and marketingMaterialDianzanVO.browseTime_end != ''">
           AND mmd.browse_time <![CDATA[<=]]> concat( #{marketingMaterialDianzanVO.browseTime_end},' 23:59:59')
       </if>
       ORDER BY mmd.browse_time DESC
   </select>
</mapper>