<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.marketing.mapper.MarketingRecommendTypeMapper">
    <select id="getMarketingRecommendTypeDTO" resultType="org.jeecg.modules.marketing.dto.MarketingRecommendTypeDTO">
      SELECT
      mrt.*,
      goodTypes.goodTypeIdThree AS goodTypeIdThree,
      goodTypes.goodTypeIdTwo AS goodTypeIdTwo,
      goodTypes.goodTypeIdOne AS goodTypeIdOne,
      goodTypes.goodTypeThreeName AS goodTypeThreeName,
      goodTypes.goodTypeTwoName AS goodTypeTwoName,
      goodTypes.goodTypeOneName AS goodTypeOneName,
      goodTypes.levels AS levels,
      CONCAT_WS('-',goodTypes.goodTypeOneName,goodTypes.goodTypeTwoName,goodTypes.goodTypeThreeName) AS goodTypeNames
      FROM
      marketing_recommend_type mrt
      LEFT JOIN
      (SELECT
      gt.id,
      gt.parent_id,
      gt.id AS goodTypeIdThree,
      gt.name AS goodTypeThreeName,
      gt.level AS levels,
      gttwo.id AS goodTypeIdTwo,
      gttwo.name AS goodTypeTwoName,
      gttwo.goodTypeIdOne AS goodTypeIdOne,
      gttwo.goodTypeOneName AS goodTypeOneName
      FROM
      good_type gt
      LEFT JOIN
      (SELECT
      gttwo.id,
      gttwo.parent_id,
      gttwo.name,
      gtOne.id AS goodTypeIdOne,
      gtOne.name AS goodTypeOneName
      FROM
      good_type gttwo
      LEFT JOIN good_type gtOne
      ON gttwo.parent_id = gtOne.id) gttwo
      ON gt.parent_id = gttwo.id) goodTypes
      ON mrt.good_type_id = goodTypes.id
      WHERE mrt.del_flag = 0
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.goodTypeNames!=null and marketingRecommendTypeVO.goodTypeNames!=''">
        AND goodTypes.goodTypeOneName  LIKE CONCAT(CONCAT('%',#{marketingRecommendTypeVO.goodTypeNames}), '%')
        or goodTypes.goodTypeTwoName  LIKE CONCAT(CONCAT('%',#{marketingRecommendTypeVO.goodTypeNames}), '%')
        or goodTypes.goodTypeThreeName  LIKE CONCAT(CONCAT('%',#{marketingRecommendTypeVO.goodTypeNames}), '%')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.nickName!=null and marketingRecommendTypeVO.nickName!=''">
        AND mrt.nick_name  LIKE CONCAT(CONCAT('%',#{marketingRecommendTypeVO.nickName}), '%')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.levels!=null and marketingRecommendTypeVO.levels!=''">
        AND levels =#{marketingRecommendTypeVO.levels}
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.status!=null and marketingRecommendTypeVO.status!=''">
        AND mrt.status =#{marketingRecommendTypeVO.status}
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.createTime_begin != null and marketingRecommendTypeVO.createTime_begin != ''">
        and mrt.create_time <![CDATA[>=]]> concat(#{marketingRecommendTypeVO.createTime_begin},' 00:00:00')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.createTime_end != null and marketingRecommendTypeVO.createTime_end != ''">
        AND mrt.create_time <![CDATA[<=]]> concat( #{marketingRecommendTypeVO.createTime_end},' 23:59:59')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.startTime_begin != null and marketingRecommendTypeVO.startTime_begin != ''">
        and mrt.start_time <![CDATA[>=]]> concat(#{marketingRecommendTypeVO.startTime_begin},' 00:00:00')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.startTime_end != null and marketingRecommendTypeVO.startTime_end != ''">
        AND mrt.start_time <![CDATA[<=]]> concat( #{marketingRecommendTypeVO.startTime_end},' 23:59:59')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.endTime_begin != null and marketingRecommendTypeVO.endTime_begin != ''">
        and mrt.end_time <![CDATA[>=]]> concat(#{marketingRecommendTypeVO.endTime_begin},' 00:00:00')
      </if>
      <if test="marketingRecommendTypeVO != null and marketingRecommendTypeVO.endTime_end != null and marketingRecommendTypeVO.endTime_end != ''">
        AND mrt.end_time <![CDATA[<=]]> concat( #{marketingRecommendTypeVO.endTime_end},' 23:59:59')
      </if>
      ORDER BY mrt.sort asc
    </select>

    <select id="findMarketingRecommendTypes" resultType="map">
        SELECT
        good_type_id AS goodTypeId,
        nick_name AS nickName,
        1 AS isPlatform
        FROM
        `marketing_recommend_type`
        WHERE del_flag = '0'
        AND STATUS = '1'
        AND NOW() &gt;= START_TIME
        AND NOW() &lt;= END_TIME
        ORDER BY sort

    </select>

</mapper>