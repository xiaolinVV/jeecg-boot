<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.good.mapper.GoodSpecificationMapper">
    <select id="getGoodSpecificationByGoodListId" resultType="org.jeecg.modules.good.entity.GoodSpecification">
        select * from  good_specification  where
        del_flag=0
        <if test="goodListId!=null and goodListId!=''">
            and good_list_id =#{goodListId}
        </if>
    </select>
    <select id="selectByGoodId" resultType="String">
        select specification from  good_specification  where
            del_flag=0 and good_list_id =#{goodListId}
    </select>

    <select id="selectByspecificationPicture" resultType="org.jeecg.modules.good.dto.SpecificationsPicturesDTO">
        SELECT specification_picture as url, SUBSTRING_INDEX(specification,',',1) name FROM `good_specification` WHERE del_flag=0
       <if test="goodListId!=null and goodListId!=''">
       and good_list_id=#{goodListId}
       </if>
        GROUP BY name
    </select>

    <update id="delpecification" >
     update
        good_specification set del_flag=1
				where good_list_id =#{goodListId} and del_flag=0
				<if test="specifications!=null and specifications.size > 0 ">
                    and  specification not in
                    <foreach collection="specifications" item="specification" separator="," open="(" close=")">
                        #{specification}
                    </foreach>
                </if>
    </update>
    <update id="updateGoodSpecificationOne" >
        UPDATE good_specification
        <trim prefix="set" suffixOverrides=",">

            <if test="goodListSpecificationVO != null and goodListSpecificationVO.price!=null and goodListSpecificationVO.price!='' ">
            price=#{goodListSpecificationVO.price},
            </if>
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.vipPrice!=null and goodListSpecificationVO.vipPrice!=''">
            vip_price=#{goodListSpecificationVO.vipPrice},
            </if>
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.costPrice!=null and goodListSpecificationVO.costPrice!=''">
            cost_price=#{goodListSpecificationVO.costPrice},
            </if>
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.supplyPrice!=null and goodListSpecificationVO.supplyPrice!=''">
            supply_price=#{goodListSpecificationVO.supplyPrice},
            </if>
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.repertory!=null and goodListSpecificationVO.repertory!=''">
            repertory=#{goodListSpecificationVO.repertory},
            </if>
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.specification!=null and goodListSpecificationVO.specification!=''">
            specification=#{goodListSpecificationVO.specification},
            </if>
            sku_no=#{goodListSpecificationVO.skuNo},
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.weight!=null and goodListSpecificationVO.weight!=''">
            weight=#{goodListSpecificationVO.weight},
            </if>
            <if test="goodListSpecificationVO!=null and goodListSpecificationVO.specificationPicture!=null and goodListSpecificationVO.specificationPicture!=''">
            specification_picture=#{goodListSpecificationVO.specificationPicture},
            </if>
        </trim>
        WHERE id=#{goodListSpecificationVO.id}
    </update>

    <update id="updateGoodSpecification" >
        update
        good_specification set del_flag=1
        where good_list_id =#{goodListId} and del_flag=0

    </update>

    <select id="getGoodSkuCount" resultType="java.lang.Long">
        SELECT
          COUNT(0)
        FROM
          `good_specification` gs
          LEFT JOIN `good_list` gl
            ON gl.id = gs.good_list_id
        WHERE gl.del_flag = 0
          AND gs.del_flag = 0
    </select>

    <select id="getGoodSpecificationByGoodId" resultType="map">
        SELECT
          gs.`id` AS goodSpecificationId,
          gs.`specification`,
          gs.`price`,
          gs.`cost_price` AS costPrice,
          gs.`supply_price` AS supplyPrice,
          gs.`vip_price` AS vipPrice,
          gs.`repertory`
        FROM
          good_specification gs
        WHERE gs.`del_flag` = 0
          AND gs.`good_list_id` = #{id}
    </select>

    <select id="chooseSpecificationByGoodId" resultType="map">

                SELECT
          id,
          specification,
          price,
          repertory,
          TRUNCATE(cost_price / price, 2) * 100 AS discount
        FROM
          `good_specification`
        WHERE good_list_id = #{goodListId}
          AND del_flag = '0'

    </select>
</mapper>
