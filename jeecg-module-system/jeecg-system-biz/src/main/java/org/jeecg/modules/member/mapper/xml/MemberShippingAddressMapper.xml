<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.member.mapper.MemberShippingAddressMapper">
    <select id="getMemberShippingAddressVo" resultType="org.jeecg.modules.member.dto.MemberShippingAddressDto">
        SELECT
          msa.id,
          msa.linkman,
          msa.phone,
          msa.area_explan,
          msa.area_address,
          msa.create_time,
          msa.is_default,
          msa.del_flag,
          msa.house_number,
          ml.head_portrait,
          ml.phone AS i_Phone,
          ml.nick_name
        FROM
          member_shipping_address msa
          LEFT OUTER JOIN member_list ml
            ON msa.`member_list_id` = ml.`id`

        WHERE 1 = 1
          AND ml.del_flag='0'
          AND msa.`del_flag` = '0'
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.iPhone != null and memberShippingAddressVo.iPhone != ''">
            and  ml.phone LIKE concat('%',concat(#{memberShippingAddressVo.iPhone},'%'))
        </if>
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.nickName != null and memberShippingAddressVo.nickName != ''">
            and  ml.nick_name LIKE concat('%',concat(#{memberShippingAddressVo.nickName},'%'))
        </if>
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.linkman != null and memberShippingAddressVo.linkman != ''">
            and  msa.linkman LIKE concat('%',concat(#{memberShippingAddressVo.linkman},'%'))
        </if>
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.phone != null and memberShippingAddressVo.phone != ''">
            and  msa.phone LIKE concat('%',concat(#{memberShippingAddressVo.phone},'%'))
        </if>
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.isDefault != null and memberShippingAddressVo.isDefault != ''">
            and  msa.is_default =#{memberShippingAddressVo.isDefault}
        </if>
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.createTime_begin != null and memberShippingAddressVo.createTime_begin != ''">
            and ml.create_time <![CDATA[>=]]> concat(#{memberShippingAddressVo.createTime_begin},' 00:00:00')
        </if>
        <if test="memberShippingAddressVo != null and memberShippingAddressVo.createTime_end != null and memberShippingAddressVo.createTime_end != ''">
            AND ml.create_time <![CDATA[<=]]> concat( #{memberShippingAddressVo.createTime_end},' 23:59:59')
        </if>
        ORDER BY msa.create_time DESC
    </select>

    <select id="getMemberShippingAddressByMemberId" resultType="map">
        select
        id as id,
        linkman as linkman,
        phone as phone,
        area_address as areaAddress,
        house_number as houseNumber,
        is_default as isDefault,
        sys_area_id as sysAreaId,
        area_explan as areaExplan
        from member_shipping_address ms
        where member_list_id=#{memberId}
        and del_flag="0"
        order by is_default desc
    </select>

    <select id="findMemberShippingAddressByMemberId" resultType="map">
        select
        id as id,
        linkman as linkman,
        phone as phone,
        area_address as areaAddress,
        house_number as houseNumber,
        is_default as isDefault,
        sys_area_id as sysAreaId,
        area_explan as areaExplan
        from member_shipping_address ms
        where member_list_id=#{memberListId}
        and del_flag="0"
        order by is_default desc
    </select>
</mapper>