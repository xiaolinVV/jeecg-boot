<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.marketing.mapper.MarketingMaterialBrowseMapper">
      <select id="getMarketingMaterialBrowseMap" resultType="map">
            SELECT
            mmd.id AS id,
            ml.head_portrait AS headPortrait,
            ml.nick_name AS nickName,
            ml.phone AS phone,
            DATE_FORMAT(mmd.browse_time,'%Y-%m-%d %H:%i:%s') AS browseTime
            FROM
            `marketing_material_browse` mmd
            LEFT JOIN `member_list` ml
            ON ml.id = mmd.member_list_id
            WHERE mmd.del_flag = 0
            <if test="marketingMaterialBrowseVO != null and marketingMaterialBrowseVO.marketingMaterialListId !=null and marketingMaterialBrowseVO.marketingMaterialListId !='' ">
                  and  mmd.marketing_material_list_id = #{marketingMaterialBrowseVO.marketingMaterialListId}
            </if>
            <if test="marketingMaterialBrowseVO != null and marketingMaterialBrowseVO.nickName !=null and marketingMaterialBrowseVO.nickName !='' ">
                  and  ml.nick_name LIKE CONCAT(CONCAT('%',#{marketingMaterialBrowseVO.nickName}), '%')
            </if>
            <if test="marketingMaterialBrowseVO != null and marketingMaterialBrowseVO.phone !=null and marketingMaterialBrowseVO.phone !='' ">
                  and  ml.phone LIKE CONCAT(CONCAT('%',#{marketingMaterialBrowseVO.phone}), '%')
            </if>
            <if test="marketingMaterialBrowseVO != null and marketingMaterialBrowseVO.browseTime_begin != null and marketingMaterialBrowseVO.browseTime_begin != ''">
                  and mmd.browse_time <![CDATA[>=]]> concat(#{marketingMaterialBrowseVO.browseTime_begin},' 00:00:00')
            </if>
            <if test="marketingMaterialBrowseVO != null and marketingMaterialBrowseVO.browseTime_end != null and marketingMaterialBrowseVO.browseTime_end != ''">
                  AND mmd.browse_time <![CDATA[<=]]> concat( #{marketingMaterialBrowseVO.browseTime_end},' 23:59:59')
            </if>
            ORDER BY mmd.browse_time DESC
      </select>
</mapper>